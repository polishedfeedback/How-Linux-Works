# üìÖ Date: 2025-10-09
## üìñ Pages Covered
From page: 70 To page: ___

---

## üìù Key Points (in my own words)
- Device names like `/dev/sda` represents the whole disk 
- Names like `/dev/sda1` `/dev/sda2` represnets the partitions on a disk
- Kernel presents `/dev/sda` and the partitions mentioned above as block devices
- Partitions are defined on a small area of a disk called *partition table*  
- A disk as explained contains partitions and each partition has a database of files and directories called *file system* which manages filesystem data structures (like inodes, allocation tables)
- It also stores the file data (actual content of the files)
- To access the file database you might need to access a particular partition first and then search the file system database on that partition to get the desired data
- Linux uses multiple layers to access the disks.
- You can access the disks either through the file system or directly through device files
- User processes like `cp`, `cat` etc operate through system calls like `read()`, `write()`, `open()`, `close()` etc and the kernel sits in between the storage device and the user processes to handle everything
- Programs like `dd`, `parted` etc can operate directly by accessing the disk device like `/dev/sda` etc to perform operations.  

### Partitioning Disk devices
- As explained, kernel presents each partition as a device file and numbers after the whole block device
- Paritition table basically shows how the disk is divided
- There are many kinds of partition tables. Old computers mostly use MBR (Master Boot Record) which has certain limitations and the latest computers use GPT (Globally Unique Identifier Partition Table)
- Here are few of the many partitioning tools:
    - `parted` - supports both MBR and GPT. CLI based 
    - `gparted` - supports both MBR and GPT. GUI based 
    - `fdisk` - supports MBR and the latest versions support GPT as well
    - `gdisk` - supports GPT. `gdisk` is basically the GPT version of the `fdisk`  

### Viewing a partition table 
- Use `parted -l` to view the system's partition table 
- We can also use `fdisk -l` to view the system's partition table
- Output for both shows what partition table is used i.e., gpt or mbr, the file system and also the flags

### Initial kernel Read
- When kernel reads the MBR initially it produces a debug output and can be viewed using `journalctl -k` 
- It shows the extended partitions and the logical partitions of the MBR table which looks something like the below
```
sda: sda1 sda2 < sda5 >
```
- Here, sda2 is the extended partition containing sda5, the logical partition

### Modifying partition tables
- Using `fdisk` to modify a partition table is different to using `parted`  
- With `fdisk` you make the partition table and then when you exit the program the changes will be committed but with `parted`, changes are made as you issue the commands
- `fdisk` changes can be seen by viewing `journalctl -k` as it makes a system call to the kernel about all the partition table changes but the chagnes made by `parted`, cannot be seen there as they don't make a disk wide system call. They just singal the kernel whenever individual partitions are altered.
- Few ways to see the partition changes
    - Using `udevadm` to watch the kernel event changes. `udevadm monitor --kernel` will show old partition devices being removed and the new ones being added
    - Checking `/proc/partitions` for full partition information
    - Checking `/sys/block/device/` for altered partition system interfaces or `/dev` for altered partition devices
- If you want to force a partition reload, you can use `blockdev` command which makes the system call that `fdisk` issues. For example to force a partition table reload on `/dev/sdf`, run the below
```
blockdev --rereadapt /dev/sdf
```
### Creating a partition table
- list out your device using `lsblk` command
- creating two partitions of sizes 200MB and 3.8GB
- MBR partition table
- Use `fdisk` to do the partition
- Use `fdisk` and then the device name for eg. `fdisk /dev/sda`. 
- Press `m` for listing out all the commands
- Press `p` to list out the current partition table 
- Most of the devices have at least one partition and to delete a partition using `fdisk`, use the option `d`
- Select a partition if there are multiple partitions already
- Remember that `fdisk` doesn't make changes until you explicitly write the partition table,so you haven't modified the disk yet.
- Incase you make a mistake, you can use the `q` option to quit without making any changes
- To create a new partition, use `n` command
- Now you have to specify the size you want the partition till. For example, in our case it is till 200MB. So you specify +200M
- Next, create another partition using the same `n` option and hit enter as you want the next parition till the end of the disk
- Next have a look at the partitions using the `p` option
- Next use `w` option to write the partition
- `fdisk` doesn't ask for if you're sure as a safety measure; it simply exits
- It calls `ioctl()` to re-read the partition table 
- Always have a look at `journalctl -k` to have a look at all the diagnostic messages
- You can also find the start and end of the partition easily by using cat. For example, to easily find the start of the partition `sda1` of the device `sda`, you can do `cat /sys/block/sda/sda1/start`  
---

## ‚ùì Flashcards
START
Basic
Front:  
Back:  
END

---

## üíª Commands Practiced
- Command: `____`
  - What it does:  
  - Example output:  

---

## üîÑ Review Log
- [ ] Day 2: {{date+1d}}
- [ ] Day 4: {{date+3d}}
- [ ] Day 8: {{date+7d}}
- [ ] Day 15: {{date+14d}}
